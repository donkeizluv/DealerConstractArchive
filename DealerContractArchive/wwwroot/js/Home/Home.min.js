var router,vm;const GetContractsListApiUrl="/api/HomeApi/GetContractViewerModel?",AddContractApiUrl="/api/HomeApi/AddNewContract",UploadContractApiUrl="/api/HomeApi/UploadScan",GetScanPdfApiUrl="/Scan/index?contractId=",GetDocumentApiUrl="/Document/GetDocument?",CurrentHost=window.location.protocol+"//"+window.location.host,ContractsListing={name:"ContractsListing",template:"#Contracts-Listing-Template",mounted:function(){this.Innit()},components:{"newcontract-modal":NewContractModal,"upload-modal":UploadModal,"printdocument-modal":PrintDocumentModal},data:function(){return{ContractViewerModel:[],ContractModels:[],TotalRows:0,TotalPages:0,OnPage:0,DocumentNames:[],SelectedFilterValue:2,SearchString:"",ShowAddContractModal:!1,ShowUploadModal:!1,ShowDocumentModal:!1,UploadToContractId:-1,ShowDocumentForId:-1}},computed:{HasFilter:function(){var type=this.$data.SelectedFilterValue,contains=this.$data.SearchString;return type!==undefined&&contains.length>0?!0:!1},ContractsListingApiPrefix:function(){return CurrentHost+GetContractsListApiUrl},GetCurrentContractsListingApi:function(){var page=this.$data.OnPage;(page<1||page==null)&&(page=1);var type=this.$data.SelectedFilterValue,contains=this.$data.SearchString,apiSuffix="page="+page;return apiSuffix=apiSuffix+"&filter="+this.HasFilter,this.HasFilter&&(this.$data.SelectedFilterValue=type,this.$data.SearchString=contains,apiSuffix=apiSuffix+"&type="+type+"&contains="+contains),this.ContractsListingApiPrefix+apiSuffix}},watch:{$route:function(to){this.$data.SearchString=to.query.contains;this.$data.SelectedFilterValue=to.query.type;this.$data.OnPage=to.query.page;this.LoadContracts(this.GetCurrentContractsListingApi)}},methods:{Innit:function(){var page=router.history.current.query.page,type,contains;(page<1||page==null)&&(page=1);type=router.history.current.query.type;type==undefined&&(type=2);contains=router.history.current.query.contains;contains==undefined&&(contains="");this.$data.OnPage=page;this.$data.SearchString=contains;this.$data.SelectedFilterValue=type;this.LoadContracts(this.GetCurrentContractsListingApi)},LoadContracts:function(url){var that=this;axios.get(url).then(function(response){that.$data.ContractViewerModel=response.data;that.$data.ContractModels=response.data.ContractModels;that.$data.DocumentNames=response.data.DocumentNames;that.UpdatePagination()}).catch(function(error){console.log(error);console.log("Failed to fetch model")})},UpdatePagination:function(){this.$data.TotalPages=this.$data.ContractViewerModel.TotalPages;this.$data.TotalRows=this.$data.ContractViewerModel.TotalRows},AddNewContractClicked:function(){this.$data.ShowAddContractModal=!0},OpenNewScanPage:function(id){var url=CurrentHost+GetScanPdfApiUrl+id;window.open(url)},ShowUploadModalHandler:function(id){this.$data.ShowUploadModal=!0;this.$data.UploadToContractId=id},PrinDocumentModalHandler:function(id){this.$data.ShowDocumentModal=!0;this.$data.ShowDocumentForId=id},OnCloseUploadModal:function(){this.$data.ShowUploadModal=!1;this.LoadContracts(this.GetCurrentContractsListingApi)},SearchButtonClicked:function(){this.$data.OnPage=1;router.push({name:"Index",query:this.GetSearchQuery(1)})},PageNavClicked:function(page){this.$data.OnPage=page;router.push({name:"Index",query:this.GetSearchQuery(page)})},GetSearchQuery:function(pageNumber){return{page:pageNumber,filter:this.HasFilter,type:this.$data.SelectedFilterValue,contains:this.$data.SearchString}}}},NewContractModal={name:"newcontract-modal",template:"#addcontract-modal-template",data:function(){return{Name:"",Phone:"",Address:"",TaxId:"",Commission:0,Status:"",AddingContract:0}},methods:{AddContract:function(){var that=this;that.$validator.validateAll().then(function(result){if(!result){that.SetStatus("Errors in inputs.");return}that.SetStatus("Adding contracts....");that.DoAddContract()})},DoAddContract:function(){var that=this,url;that.$data.AddingContract=1;url=CurrentHost+AddContractApiUrl;console.log(url);axios.post(url,{Name:that.$data.Name,Address:that.$data.Address,Phone:that.$data.Phone,TaxId:that.$data.TaxId,Commission:that.$data.Commission,Effective:!0,UserId:1,ScannedContractUrl:null}).then(function(){that.SetStatus("Success!");that.$data.AddingContract=0;that.ClearData()}).catch(function(error){that.SetStatus("Fail to add contract, status: "+error.response.status);that.$data.AddingContract=0;that.ClearData()})},ClearData:function(){this.$data.Name="";this.$data.Phone="";this.$data.Address="";this.$data.TaxId="";this.$data.Commission=0;this.errors.clear();this.$validator.reset()},SetStatus:function(message){this.$data.Status=message}}},PrintDocumentModal={name:"printdocument-modal",template:"#printdocument-modal-template",props:["docnames","contractid"],data:function(){return{SelectedDoc:""}},methods:{OpenPrintPage:function(){var url=CurrentHost+GetDocumentApiUrl+"contractid="+this.contractid+"&docName="+this.$data.SelectedDoc;window.open(url)}}},UploadModal={name:"upload-modal",template:"#uploadscanned-modal-template",computed:{progressStyle:function(){return{width:this.$data.Progress+"%"}}},props:["contractid"],data:function(){return{options:{method:"post",uploadMultiple:!1,url:UploadContractApiUrl+"?contractId="+this.contractid,paramName:"file",maxFilesize:10,maxFiles:1,acceptedFiles:{extensions:["application/pdf"],message:"You are uploading an invalid file!"}},Uploading:0,Progress:0,Filename:"",Status:"",Uploadable:!0}},methods:{addedfile:function(file){this.$data.Uploading=1;this.$data.Filename=file.name},uploadcompleted:function(file,status,xhr){this.$data.Status=status!="success"?xhr.status==500?"Server error!":xhr.response:"Success!";this.$data.Uploading=0;this.$data.Progress=0;this.$data.Uploadable=!1},uploadprogresschange:function(progress){this.$data.Progress=progress}}};router=new VueRouter({mode:"history",base:"Home",routes:[{name:"Default",path:"/",component:ContractsListing},{name:"Index",path:"/Index",component:ContractsListing}]});Vue.use(VueRouter);Vue.use(VeeValidate);vm=new Vue({el:"#app",router:router});